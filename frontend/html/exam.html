<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/frontend/styles/exam.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
  </head>

  <body>
    <h1 class="header">geNiUS</h1>
    <div class="dateInput">
      <nav class="sideNav">
        <button class="navButton" onclick="window.location.href='/frontend/html/dashboard.html'">
          <span class="material-symbols-outlined">
            home 
          </span>Dashboard</button>
        
        <button class="navButton" onclick="window.location.href='/frontend/html/timetable.html'">
          <span class="material-symbols-outlined">
            schedule
            </span>Timetable</button>
  
        <button class="navButton" onclick="window.location.href='/frontend/html/exam.html'">
          <span class="material-symbols-outlined">
            school
            </span>Exam Management</button>
            
        <button class="navButton" id="logoutButton">
          <span class="material-symbols-outlined">
            output
            </span>Log out</button>
      </nav>

      
      <section class="modal hidden">
        <div>
          <button class="closeModal">x</button>
        </div>

        <div class="flex-input">
          <label for="examName" class="name-label">Exam: </label>
          <input type="text" id="examName" placeholder="What exam do you have?">
        </div>

        <div class="flex-input">
          <label for="examDate" class="date-label">Exam: </label>
          <input type="datetime-local" id="countdownDate"/>
        </div>
        
        <div class="flex-input">
          <label for="examVenue" class="venue-label">Exam: </label>
          <input type="text" id="examName" placeholder="Exam venue">
        </div>

        
        <div id="textBoxContainer">
          
          <div class="textBox-container">
            <label for="examContent" class="content-label">Exam content: </label>
            <input type="text" id="examContent" placeholder="Content">
          </div>
          
          <button id="addContent">+</button>
          
        </div>
      </section>
      
      <div class="overlay hidden"></div>
      <button class="openModal">Add</button>
      
      
        <div class="modalBox"> 

          <div class="modalContent">
            <div class="flex-input">
              <label for="name" class="name-label">Exam: </label>
              <input type="text" id="name" placeholder="What exam do you have?">
            </div>
            
            <div class="flex-input">
              <label for="countdownDate" class="countdown-label">Countdown Date: </label>
              <input type="datetime-local" id="countdownDate" />
            </div>
            
            <button class="startCDButton">Start</button>
          </div>
      
      
        
      </div>
      
      <div id="timerDisplay">
        <div class="time">
          <p>Days</p>
          <span id="days">00</span>
        </div>
        
        <div class="time">
          <p>Hours</p>
          <span id="hours">00</span>
        </div>
        
        <div class="time">
          <p>Mins</p>
          <span id="mins">00</span>
        </div>
        
        <div class="time">
          <p>Secs</p>
          <span id="secs">00</span>
        </div>
      
      
      
      </div>
    </div>

    <script>

    let countdownInterval;

    function startCountdown() {
      const inputDate = new Date(document.getElementById("countdownDate").value).getTime(); //getTime gets the millisecs of time starting from midnight

      localStorage.setItem('countdownDate', JSON.stringify(inputDate)); //stringfy input date,then store in local storage

      countdownInterval = setInterval( function() {
        const now = new Date().getTime(); //time now in millisec
        const storedDate = parseInt(localStorage.getItem('countdownDate'));//get input date in millisec, retrieve from local storage
        const remTime = storedDate - now; //get the time difference

        if (remTime <= 0) { 
          clearInterval(countdownInterval);
          localStorage.removeItem("countdownDate");
          /*document.getElementById("days").innerHTML = 00; 
          document.getElementById("hours").innerHTML = 00;
          document.getElementById("mins").innerHTML = 00;
          document.getElementById("secs").innerHTML = 00;
          localStorage.removeItem("countdownDate");
          */
          document.getElementById("timerDisplay").textContent = "All the best!"
          return;
        }

        //displaying the time rem to date
        const days = Math.floor(remTime / (1000 * 60 * 60 * 24));
        const hours = Math.floor((remTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const mins = Math.floor((remTime % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((remTime % (1000 * 60)) / 1000);

        /*document.getElementById("days").innerHTML = days; 
        document.getElementById("hours").innerHTML = ("0" + hours);
        document.getElementById("mins").innerHTML = ("0" + mins);
        document.getElementById("secs").innerHTML = ("0" + secs);*/
        
        document.getElementById("timerDisplay").innerHTML = days + "d " + hours + "h " + mins + "m " + secs + "s ";
      }, 1000);


      
    }

        

    window.onload = function() {
      if (localStorage.getItem("countdownDate")) { //check if there is a countdown date stored
        
        const newNow = new Date().getTime();
        const newDate = Date(parseInt(localStorage.getItem("countdownDate")));
        
        countdownInterval = setInterval( function() {
          const now = new Date().getTime(); //time now in millisec
          const storedDate = parseInt(localStorage.getItem('countdownDate'));//get input date in millisec, retrieve from local storage
          const remTime = storedDate - now; //get the time difference

          if (remTime <= 0) { 
            clearInterval(countdownInterval);
            document.getElementById("timerDisplay").innerHTML = "All the best!"
            return;
          }

          //displaying the time rem to date
          const days = Math.floor(remTime / (1000 * 60 * 60 * 24));
          const hours = Math.floor((remTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const mins = Math.floor((remTime % (1000 * 60 * 60)) / (1000 * 60));
          const secs = Math.floor((remTime % (1000 * 60)) / 1000);

          document.getElementById("timerDisplay").innerHTML = days + "d " + hours + "h " + mins + "m " + secs + "s ";
        }, 1000);
        
      } else { //when there is no local storage
        startCountdown();
      }
    }
    
    const modal = document.querySelector(".modal");
    const overlay = document.querySelector(".overlay");
    const openModalBtn = document.querySelector(".openModal");
    const closeModalBtn = document.querySelector(".closeModal");

    const openModal = function () {
      modal.classList.remove("hidden");
      overlay.classList.remove("hidden"); //remove hidden class, so it will show the display
    };

    const closeModal = function () {
      modal.classList.add("hidden");
      overlay.classList.add("hidden");
    }

    document.addEventListener("keydown", function(e) {
      if (e.key ==="Enter" && !modal.classList.contains("hidden")) {
        closeModal();
      }
    })

    openModalBtn.addEventListener("click", openModal);
    closeModalBtn.addEventListener("click", closeModal)
    overlay.addEventListener("click", closeModal)

    
    const addcontentBtn = document.getElementById("addContent");
  
    let textboxCount = 1;

    addcontentBtn.addEventListener("click", function(){
      const textBoxContainer = document.getElementById("textBoxContainer");
      const newtextboxContainer = document.createElement("div");
      newtextboxContainer.classList.add("textBox-container");

      const textbox = document.createElement("input");
      textbox.setAttribute("type",  "text");
      textbox.setAttribute("id", "textbox", (textboxCount + 1));
      textbox.classList.add("textbox");
      textbox.placeholder = "More exam content...";
      
      
      newtextboxContainer.appendChild(textbox);
      textBoxContainer.appendChild(newtextboxContainer);
      textboxCount++;
    });
    
    
    
    </script>
    <script type="text/javascript" src="/frontend/js/logout.js"></script>
  </body>

</html></html>
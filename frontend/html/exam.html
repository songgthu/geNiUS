<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/frontend/styles/exam.css">
  </head>

  <body>
    <h1>geNiUS</h1>
    <div class="dateInput">
      <nav class="sideNav">
        <button class="navButton" onclick="window.location.href='/frontend/html/dashboard.html'">
          <span class="material-symbols-outlined">
            home 
          </span>Dashboard</button>
        
        <button class="navButton" onclick="window.location.href='/frontend/html/timetable.html'">
          <span class="material-symbols-outlined">
            schedule
            </span>Timetable</button>
  
        <button class="navButton" onclick="window.location.href='/frontend/html/exam.html'">
          <span class="material-symbols-outlined">
            school
            </span>Exam Management</button>
            
        <button class="navButton" id="logoutButton">
          <span class="material-symbols-outlined">
            output
            </span>Log out</button>
      </nav>
      <input type="text" id="name" placeholder="What exam do you have?">
      <label for="countdownDate">Countdown Date: </label>
      <input type="datetime-local" id="countdownDate" />
      <button onclick="startCountdown()">Start</button>
      <div id="timerDisplay">
        <div class="time">
          <p>Days</p>
          <span id="days">00</span>
        </div>
        
        <div class="time">
          <p>Hours</p>
          <span id="hours">00</span>
        </div>
        
        <div class="time">
          <p>Mins</p>
          <span id="mins">00</span>
        </div>
        
        <div class="time">
          <p>Secs</p>
          <span id="secs">00</span>
        </div>
      
      
      
      </div>
    </div>

    <script>

    let countdownInterval;

    function startCountdown() {
      const inputDate = new Date(document.getElementById("countdownDate").value).getTime(); //getTime gets the millisecs of time starting from midnight

      localStorage.setItem('countdownDate', JSON.stringify(inputDate)); //stringfy input date,then store in local storage

      countdownInterval = setInterval( function() {
        const now = new Date().getTime(); //time now in millisec
        const storedDate = parseInt(localStorage.getItem('countdownDate'));//get input date in millisec, retrieve from local storage
        const remTime = storedDate - now; //get the time difference


        //displaying the time rem to date
        const days = Math.floor(remTime / (1000 * 60 * 60 * 24));
        const hours = Math.floor((remTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const mins = Math.floor((remTime % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((remTime % (1000 * 60)) / 1000);

        /*document.getElementById("days").innerHTML = days; 
        document.getElementById("hours").innerHTML = ("0" + hours).slice(-2);
        document.getElementById("mins").innerHTML = ("0" + mins).slice(-2);
        document.getElementById("secs").innerHTML = ("0" + secs).slice(-2);
        */
        document.getElementById("timerDisplay").innerHTML = days + "d " + hours + "h " + mins + "m " + secs + "s ";
      }, 1000);


      if (remTime <= 0) { 
          clearInterval(countdownInterval);
          document.getElementById("timerDisplay").innerHTML = days + "d " + hours + "h " + mins + "m " + secs + "s ";

          /*document.getElementById("days").innerHTML = 00; 
          document.getElementById("hours").innerHTML = 00;
          document.getElementById("mins").innerHTML = 00;
          document.getElementById("secs").innerHTML = 00;
          localStorage.removeItem("countdownDate");
          */
          document.getElementById("timerDisplay").textContent = "All the best!"
          return;
        }
    }

        

    window.onload = function() {
      if (localStorage.getItem("countdownDate")) { //check if there is a countdown date stored
        
        const newNow = new Date().getTime();
        const newDate = Date(parseInt(localStorage.getItem("countdownDate")));
        
        countdownInterval = setInterval( function() {
          const now = new Date().getTime(); //time now in millisec
          const storedDate = parseInt(localStorage.getItem('countdownDate'));//get input date in millisec, retrieve from local storage
          const remTime = storedDate - now; //get the time difference

          if (remTime <= 0) { 
            clearInterval(countdownInterval);
            document.getElementById("timerDisplay").innerHTML = "All the best!"
            return;
          }

          //displaying the time rem to date
          const days = Math.floor(remTime / (1000 * 60 * 60 * 24));
          const hours = Math.floor((remTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const mins = Math.floor((remTime % (1000 * 60 * 60)) / (1000 * 60));
          const secs = Math.floor((remTime % (1000 * 60)) / 1000);

          document.getElementById("timerDisplay").innerHTML = days + "d " + hours + "h " + mins + "m " + secs + "s ";
        }, 1000);
        
      } else { //when there is no local storage
        startCountdown();
      }
    }
    
    </script>
    <script type="text/javascript" src="/frontend/js/logout.js"></script>
  </body>

</html>